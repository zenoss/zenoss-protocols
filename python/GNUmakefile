##############################################################################
# 
# Copyright (C) Zenoss, Inc. 2010, all rights reserved.
# 
# This content is made available according to terms specified in
# License.zenoss under the directory where your Zenoss product is installed.
# 
##############################################################################


PROTODIR = zenoss/protocols/protobufs
DATADIR = zenoss/protocols/data
PROTOC = protoc
PYTHON = python
default: build

define QJS_BUILD
import json
from pprint import pformat
data = json.load(open("../interface/src/zenoss.qjs", "r"))

print "# Generated by Zenoss build, do not modify directly"
print 'SCHEMA = %s' % pformat(data, 4)
endef
export QJS_BUILD

build:
	mkdir -p ${PROTODIR} && touch ${PROTODIR}/__init__.py
	cp -r ../interface/src/protobufs/zenoss/protocols/protobufs/*.proto ${PROTODIR}
	$(PROTOC) -I ../interface/src/protobufs/ --python_out=. ../interface/src/protobufs/zenoss/protocols/protobufs/*.proto
	mkdir -p ${DATADIR} && touch ${DATADIR}/__init__.py
	$(PYTHON) -c "$$QJS_BUILD" > ${DATADIR}/queueschema.py
	$(PYTHON) setup.py sdist

clean:
	rm -rf ${PROTODIR}
	rm -rf build
	rm -rf dist
	rm -rf zenoss.protocols.egg-info
	rm -rf ${DATADIR}
